from flask import Flask, request, jsonify
from flask_sqlalchemy import SQLAlchemy
import json

app = Flask(__name__)


app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///cryptodata.db'
db = SQLAlchemy(app)

# table_headers = ["Rank", "CryptoCurrency", "Market Cap", "Price", "Circulating Supply", "Volume(24h)", "Change(24h)"]

class CryptoData(db.Model):
    rank = db.Column(db.String, primary_key=True)
    cryptocurrency = db.Column(db.String(120), nullable=False)
    # marketcap = db.Column(db.String(120), nullable=False)
    price = db.Column(db.String(120), nullable=False)
    # supply = db.Column(db.String(120), nullable=False)
    # volume = db.Column(db.String(120), nullable=False)
    # change = db.Column(db.String(120), nullable=False)


    def __repr__(self):
        return "{self.name} - {self.price}"

def load_data():

# 0,1,3
    l = [['1', 'Bitcoin', '$783,527,705,812', '$41,614.00', '18,829,687', '$29,321,365,978', '0.83 %'], ['2', 'Ethereum', '$336,086,400,383', '$2,853.60', '117,724,940', '$17,574,566,168', '1.05 %'], ['3', 'Tether', '$69,574,640,137', '$1.00', '69,339,570,575', '$58,346,464,870', '0.31 %'], 
    ['4', 'Cardano', '$65,987,546,273', '$2.06', '32,066,390,668', '$2,556,351,667', '0.18 %'], ['5', 'Binance Coin', '$56,878,978,266', '$368.05', '154,533,652', '$2,100,588,350', '10.51 %'], ['6', 'XRP', '$43,814,903,423', '$0.94', '46,750,439,262', '$4,126,603,106', '3.15 %'], ['8', 'USD Coin', '$31,596,514,994', '$1.00', '31,518,258,702', '$3,592,505,153', '0.14 %'], ['9', 'Polkadot', '$28,372,016,203', '$27.49', '1,035,373,202', '$1,151,006,988', '3.42 %'], ['10', 'Dogecoin', '$26,302,491,830', '$0.20', '131,487,708,520', '$790,259,404', '1.04 %'], ['12', 'Terra', '$13,777,643,200', '$34.47', '399,686,079', '$1,109,840,482', '1.66 %'], ['13', 'Binance USD', '$13,432,106,067', '$1.00', '13,456,370,138', '$3,838,330,349', '0.24 %'], ['15', 'Chainlink', '$10,488,539,788', '$23.04', '455,009,554', '$944,828,778', '2.87 %'], ['16', 'Litecoin', 
    '$9,807,629,330', '$147.21', '66,752,615', '$2,638,230,030', '2.38 %'], ['17', 'Algorand', '$9,659,038,236', '$1.62', '5,960,351,781', '$443,875,954', '0.81 %'], ['18', 'Cosmos', '$9,581,370,361', '$34.23', '279,921,018', '$920,239,323', '-0.81 %'], ['19', 'Bitcoin Cash', '$9,185,298,218', '$486.92', '18,858,944', '$6,784,474,359', '1.16 %'], ['23', 'Stellar', '$6,455,507,773', '$0.27', '23,753,038,591', '$418,458,251', '4.46 %'], ['25', 'Dai', '$6,178,457,774', '$1.00', '6,177,180,661', '$440,830,650', '0.09 %'], ['26', 'TRON', '$6,173,479,384', '$0.09', '71,660,220,128', '$1,140,508,488', '2.43 %'], ['27', 'FTX Token', '$6,011,153,706', '$49.99', '120,546,132', '$488,972,442', '-0.52 %'], ['28', 'Ethereum Classic', '$5,971,764,364', '$45.80', '130,356,704', '$4,078,664,874', '1.38 %'], ['29', 'VeChain', '$5,671,942,089', '$0.08', '66,760,741,299', '$328,968,009', '1.40 %'], ['30', 'cETH', '$5,382,317,672', '$57.14', '94,114,934', '$15,907,320', '0.81 %'], ['31', 'Tezos', '$4,958,018,545', '$5.76', '861,316,706', '$495,298,122', '0.87 %'], ['33', 'Theta Network', '$4,811,774,315', '$4.81', '1,000,000,000', '$224,962,355', '0.66 %'], ['35', 'cUSDC', '$4,559,426,595', '$0.02', '204,913,943,867', '$3,568,252', '-0.36 %'], ['36', 'cDAI', '$4,443,964,477', '$0.02', '205,053,919,908', '$37,349,734', '0.06 %'], ['38', 'Monero', '$4,221,637,172', '$234.52', '18,002,051', '$215,584,092', '2.42 %'], ['40', 'OKB', '$4,184,675,233', '$15.85', '265,115,438', '$546,414,135', '1.15 %'], ['41', 'Elrond', '$4,025,050,256', '$203.69', '19,823,489', '$164,993,952', '0.90 %'], ['42', 'Crypto.com Coin', '$3,778,504,836', '$0.15', '25,263,013,692', '$34,829,634', '0.98 %'], ['44', 'Quant', '$3,704,855,212', '$276.89', '13,375,967', '$53,021,047', '-1.99 %'], ['45', 'EOS', '$3,661,490,025', '$3.78', '968,834,952', '$1,077,347,416', '1.53 %'], ['48', 'Hedera Hashgraph', '$3,213,889,848', '$0.31', '10,288,891,178', '$128,738,846', '1.03 %'], ['52', 'IOTA', '$2,918,496,835', '$1.05', '2,779,530,283', '$99,745,476', '-3.84 %'], ['53', 'Kusama', '$2,910,706,668', '$326.62', '8,980,098', '$153,483,184', '2.12 %'], ['54', 'LEO Token', '$2,726,818,002', '$2.89', '944,877,465', '$458,484', '7.20 %'], ['57', 'NEO', '$2,666,434,506', '$37.79', '70,530,000', '$299,089,900', '3.65 %'], ['58', 'Bitcoin SV', '$2,381,744,585', '$126.31', '18,855,714', '$271,708,688', '1.50 %'], ['60', 'Waves', '$2,316,745,766', '$23.16', '100,000,000', '$168,958,714', '-1.11 %'], ['62', 'Celsius Network', '$2,116,668,946', '$5.00', '423,415,980', '$6,539,446', '0.12 %'], ['63', 'Maker', '$2,031,690,970', '$2,254.15', '901,311', '$76,673,149', '-0.61 %'], ['64', 'BitTorrent', '$2,019,159,563', '$0.00', '659,071,882,049', '$167,383,463', '1.28 %'], ['65', 'Compound', '$1,844,305,754', '$323.99', '5,713,561', '$80,505,874', '0.38 %'], ['67', 'THORChain', '$1,758,945,559', '$6.70', '262,741,793', '$46,267,828', '1.04 %'], ['71', 'Synthetix Network Token', '$1,654,543,597', '$9.46', '174,835,488', '$70,859,454', '1.15 %'], ['72', 'Dash', '$1,602,358,797', '$154.68', '10,357,424', '$292,206,026', '2.35 %'], ['77', 'OMG Network', '$1,453,252,714', '$10.43', '140,245,398', '$1,387,969,916', '16.04 %'], ['79', 'TrueUSD', '$1,396,837,726', '$1.00', '1,394,819,930', '$91,445,341', '0.13 %'], ['80', 'Holo', '$1,375,137,093', '$0.01', '177,619,433,541', '$97,086,980', '1.67 %'], ['82', 'Decred', '$1,306,937,976', '$97.77', '13,356,996', '$14,099,338', '0.16 %'], ['83', 'Huobi Token', '$1,275,240,957', '$7.77', '164,081,489', '$197,823,445', '3.18 %'], 
    ['85', 'NEM', '$1,249,448,213', '$0.14', '8,999,999,999', '$37,740,777', '1.06 %'], ['87', 'Stacks', '$1,209,446,885', '$1.15', '1,052,561,462', '$16,814,614', '1.22 %'], ['88', 'Zcash', '$1,210,894,070', '$104.13', '11,627,942', '$206,950,409', '2.26 %'], ['89', 'Enjin Coin', '$1,147,835,084', '$1.23', '934,340,660', '$51,704,422', '0.32 %'], ['91', 'Pax Dollar', '$1,022,017,389', '$1.00', '1,020,708,693', '$12,792,462', '0.27 %'], ['92', 'yearn.finance', '$1,018,372,696', '$28,845.00', '35,693', '$261,319,905', '1.33 %'], ['93', 'Zilliqa', '$1,022,727,365', '$0.08', '12,550,543,801', '$97,406,923', '7.14 %'], ['94', 'Aave [OLD]', '$1,253,885,331', '$6.02', '53,688,345', '$13,140', '51.13 %'], ['96', 'ICON', '$969,265,078', '$1.44', '670,752,804', '$47,608,126', '1.46 %'], ['98', 'DxChain Token', '$94,790,225', '$0.00', '0', '$156,923', '3.37 %'], ['99', 'Qtum', '$933,577,151', '$8.99', '103,771,598', '$192,306,757', '1.38 %'], ['100', 'Ravencoin', '$905,935,164', '$0.09', '9,756,750,000', '$35,915,447', '0.15 %']]

    for i in range(len(l)):
        row = l[i]
        curr = CryptoData(rank = i+1, cryptocurrency = row[1], price = row[3])
        db.session.add(curr)
        db.session.commit()



@app.route('/api/all')
def get_all_data():
    #load_data()
    data = CryptoData.query.all()

    output = []
    for row in data:
        output.append({"Rank": row.rank, 
        "CryptoCurrency": row.cryptocurrency,
        "Price": row.price
        })
    
    return {"CryptoData": output}